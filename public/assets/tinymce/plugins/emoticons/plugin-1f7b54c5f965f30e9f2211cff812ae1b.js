/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.7.1 (2021-03-17)
 */
!function(){"use strict";var e,t,n,r,a=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=function(e){var t=e;return{get:function(){return t},set:function(e){t=e}}},c=Object.prototype.hasOwnProperty,s=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},a=0;a<t.length;a++){var i=t[a];for(var o in i)c.call(i,o)&&(r[o]=e(r[o],i[o]))}return r},l=function(e){return function(){return e}},u=l(!(e=function(e,t){return t})),f=l(!0),d=function(){return m},m=(t=function(e){return e.isNone()},{fold:function(e){return e()},is:u,isSome:u,isNone:f,getOr:r=function(e){return e},getOrThunk:n=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:l(null),getOrUndefined:l(void 0),or:r,orThunk:n,map:d,each:function(){},bind:d,exists:u,forall:f,filter:d,equals:t,equals_:t,toArray:function(){return[]},toString:l("none()")}),g=function(e){var t=l(e),n=function(){return a},r=function(t){return t(e)},a={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:f,isNone:u,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return g(t(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?a:m},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(u,function(t){return n(e,t)})}};return a},h={some:g,none:d,from:function(e){return null===e||void 0===e?m:g(e)}},p=Object.keys,y=Object.hasOwnProperty,v=function(e,t){for(var n=p(e),r=0,a=n.length;a>r;r++){var i=n[r];t(e[i],i)}},b=function(e,t){var n={};return v(e,function(e,r){var a=t(e,r);n[a.k]=a.v}),n},k=function(e,t){return-1!==e.indexOf(t)},w=tinymce.util.Tools.resolve("tinymce.Resource"),_=tinymce.util.Tools.resolve("tinymce.util.Delay"),C=tinymce.util.Tools.resolve("tinymce.util.Promise"),x="All",z={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},S=function(e,t){return n=e,r=t,y.call(n,r)?e[t]:t;var n,r},E=function(e){var t,n=e.getParam("emoticons_append",{},"object");return t=function(e){return i({keywords:[],category:"user"},e)},b(n,function(e,n){return{k:n,v:t(e,n)}})},N=function(e,t,n){var r=o(h.none()),a=o(h.none()),i=e.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string"),c=function(e){var t={},n=[];v(e,function(e,r){var a,o,c,s,l,u={title:r,keywords:e.keywords,"char":(o=(a=e)["char"],l=0,s="<img",(c=o).length>=s.length&&c.substr(l,l+s.length)===s?a["char"].replace(/src="([^"]+)"/,function(e,t){return'src="'+i+t+'"'}):a["char"]),category:S(z,e.category)},f=void 0!==t[u.category]?t[u.category]:[];t[u.category]=f.concat([u]),n.push(u)}),r.set(h.some(t)),a.set(h.some(n))};e.on("init",function(){w.load(n,t).then(function(t){var n=E(e);c(s(t,n))},function(e){console.log("Failed to load emoticons: "+e),r.set(h.some({})),a.set(h.some([]))})});var l=function(){return a.get().getOr([])},u=function(){return r.get().isSome()&&a.get().isSome()};return{listCategories:function(){return[x].concat(p(r.get().getOr({})))},hasLoaded:u,waitForLoad:function(){return u()?C.resolve(!0):new C(function(e,n){var r=15,a=_.setInterval(function(){u()?(_.clearInterval(a),e(!0)):--r<0&&(console.log("Could not load emojis from url: "+t),_.clearInterval(a),n(!1))},100)})},listAll:l,listCategory:function(e){return e===x?l():r.get().bind(function(t){return h.from(t[e])}).getOr([])}}},T=function(e,t,n){for(var r=[],a=t.toLowerCase(),i=n.fold(function(){return u},function(e){return function(t){return t>=e}}),o=0;o<e.length&&(0!==t.length&&!function(e,t){return k(e.title.toLowerCase(),t)||function(e,t){for(var n=0,r=e.length;r>n;n++)if(t(e[n],n))return!0;return!1}(e.keywords,function(e){return k(e.toLowerCase(),t)})}(e[o],a)||(r.push({value:e[o]["char"],text:e[o].title,icon:e[o]["char"]}),!i(r.length)));o++);return r},D="pattern",A=function(e,t){var n,r,a,i={pattern:"",results:T(t.listAll(),"",h.some(300))},c=o(x),s=(n=function(e){var n,r,a,i,o;r=(n=e).getData(),a=c.get(),i=t.listCategory(a),o=T(i,r[D],a===x?h.some(300):h.none()),n.setData({results:o})},r=200,a=null,{cancel:function(){null!==a&&(clearTimeout(a),a=null)},throttle:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];null!==a&&clearTimeout(a),a=setTimeout(function(){n.apply(null,e),a=null},r)}}),l={label:"Search",type:"input",name:D},u={type:"collection",name:"results"},f=function(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(e,t){for(var n=e.length,r=new Array(n),a=0;n>a;a++){var i=e[a];r[a]=t(i,a)}return r}(t.listCategories(),function(e){return{title:e,name:e,items:[l,u]}})},initialData:i,onTabChange:function(e,t){c.set(t.newTabName),s.throttle(e)},onChange:s.throttle,onAction:function(t,n){var r,a;"results"===n.name&&(r=e,a=n.value,r.insertContent(a),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},d=e.windowManager.open(f());d.focus(D),t.hasLoaded()||(d.block("Loading emoticons..."),t.waitForLoad().then(function(){d.redial(f()),s.throttle(d),d.focus(D),d.unblock()})["catch"](function(){d.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),d.focus(D),d.unblock()}))};a.add("emoticons",function(e,t){var n,r,a,i,o,c,s,l,u,f=(r=t,a=(n=e).getParam("emoticons_database","emojis","string"),n.getParam("emoticons_database_url",r+"/js/"+a+n.suffix+".js","string")),d=e.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),m=N(e,f,d);o=m,c=function(){return A(i,o)},(i=e).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:c}),i.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:c}),l=m,(s=e).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(e,t){return l.waitForLoad().then(function(){var n=l.listAll();return T(n,e,h.some(t))})},onAction:function(e,t,n){s.selection.setRng(t),s.insertContent(n),e.hide()}}),(u=e).on("PreInit",function(){u.parser.addAttributeFilter("data-emoticon",function(e){!function(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}(e,function(e){e.attr("data-mce-resize","false"),e.attr("data-mce-placeholder","1")})})})})}();