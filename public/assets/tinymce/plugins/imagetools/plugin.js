/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.7.1 (2021-03-17)
 */
!function(){"use strict";function e(e){var t=this;null!==this._state?f(function(){var n,r=t._state?e.onFulfilled:e.onRejected;if(null!==r){try{n=r(t._value)}catch(a){return void e.reject(a)}e.resolve(n)}else(t._state?e.resolve:e.reject)(t._value)}):this._deferreds.push(e)}function t(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void g(d(a,e),d(t,this),d(n,this))}this._state=!0,this._value=e,r.call(this)}catch(i){n.call(this,i)}}function n(e){this._state=!1,this._value=e,r.call(this)}function r(){for(var t=0,n=this._deferreds;t<n.length;t++){var r=n[t];e.call(this,r)}this._deferreds=[]}function a(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}var i,o,c,s,l,u,f,d,m,g,h=function(e){var t=e;return{get:function(){return t},set:function(e){t=e}}},p=tinymce.util.Tools.resolve("tinymce.PluginManager"),y=tinymce.util.Tools.resolve("tinymce.util.Tools"),v=function(){},b=function(e){return function(){return e}},w=b(!1),k=b(!0),_=function(){return C},C=(i=function(e){return e.isNone()},{fold:function(e){return e()},is:w,isSome:w,isNone:k,getOr:c=function(e){return e},getOrThunk:o=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:b(null),getOrUndefined:b(void 0),or:c,orThunk:o,map:_,each:v,bind:_,exists:w,forall:k,filter:_,equals:i,equals_:i,toArray:function(){return[]},toString:b("none()")}),x=function(e){var t=b(e),n=function(){return a},r=function(t){return t(e)},a={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:k,isNone:w,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:n,orThunk:n,map:function(t){return x(t(e))},each:function(t){t(e)},bind:r,exists:r,forall:r,filter:function(t){return t(e)?a:C},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(w,function(t){return n(e,t)})}};return a},z={some:x,none:_,from:function(e){return null===e||void 0===e?C:x(e)}},S=function(e){return!(null===(t=e)||void 0===t);var t},E=(s="function",function(e){return typeof e===s}),N=function(e,t){return A(document.createElement("canvas"),e,t)},T=function(e){var t=N(e.width,e.height);return D(t).drawImage(e,0,0),t},D=function(e){return e.getContext("2d")},A=function(e,t,n){return e.width=t,e.height=n,e},O=window.Promise?window.Promise:(l=function(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],g(e,d(t,this),d(n,this))},u=window,f=l.immediateFn||"function"==typeof u.setImmediate&&u.setImmediate||function(e){return setTimeout(e,1)},d=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.apply(t,n)}},m=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},g=function(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(a){if(r)return;r=!0,n(a)}},l.prototype["catch"]=function(e){return this.then(null,e)},l.prototype.then=function(t,n){var r=this;return new l(function(i,o){e.call(r,new a(t,n,i,o))})},l.all=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Array.prototype.slice.call(1===e.length&&m(e[0])?e[0]:e);return new l(function(e,t){if(0===n.length)return e([]);for(var r=n.length,a=function(i,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var c=o.then;if("function"==typeof c)return void c.call(o,function(e){a(i,e)},t)}n[i]=o,0==--r&&e(n)}catch(s){t(s)}},i=0;i<n.length;i++)a(i,n[i])})},l.resolve=function(e){return e&&"object"==typeof e&&e.constructor===l?e:new l(function(t){t(e)})},l.reject=function(e){return new l(function(t,n){n(e)})},l.race=function(e){return new l(function(t,n){for(var r=0,a=e;r<a.length;r++)a[r].then(t,n)})},l),R=function(e){return new O(function(t,n){var r=URL.createObjectURL(e),a=new Image,i=function(){a.removeEventListener("load",o),a.removeEventListener("error",c)},o=function(){i(),t(a)},c=function(){i(),n("Unable to load data of type "+e.type+": "+r)};a.addEventListener("load",o),a.addEventListener("error",c),a.src=r,a.complete&&setTimeout(o,0)})},P=function(e){return new O(function(t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.onload=function(){200===this.status&&t(this.response)},r.onerror=function(){var e,t=this;n(0===this.status?((e=new Error("No access to download image")).code=18,e.name="SecurityError",e):new Error("Error "+t.status+" downloading image"))},r.send()})},L=function(e){return new O(function(t,n){(function(e){var t=e.split(","),n=/data:([^;]+)/.exec(t[0]);if(!n)return z.none();for(var r=n[1],a=t[1],i=atob(a),o=i.length,c=Math.ceil(o/1024),s=new Array(c),l=0;c>l;++l){for(var u=1024*l,f=Math.min(1024+u,o),d=new Array(f-u),m=u,g=0;f>m;++g,++m)d[g]=i[m].charCodeAt(0);s[l]=new Uint8Array(d)}return z.some(new Blob(s,{type:r}))})(e).fold(function(){n("uri is not base64: "+e)},t)})},j=function(e,t,n){return t=t||"image/png",E(HTMLCanvasElement.prototype.toBlob)?new O(function(r,a){e.toBlob(function(e){e?r(e):a()},t,n)}):L(e.toDataURL(t,n))},B=function(e){return R(e).then(function(e){M(e);var t,n,r=N((n=e).naturalWidth||n.width,(t=e).naturalHeight||t.height);return D(r).drawImage(e,0,0),r})},M=function(e){URL.revokeObjectURL(e.src)},I=R,F=function(e){return(0===(t=e.src).indexOf("data:")?L:P)(t);var t},H=function(e,t){return function(e,t,n){for(var r=0,a=e.length;a>r;r++){var i=e[r];if(t(i,r))return z.some(i);if(n(i,r))break}return z.none()}(e,t,w)},q=function(e,t,n){var r=t.type,a=b(r),i=b(n),o=function(t,n){return e.then(function(e){return a=n,r=(r=t)||"image/png",e.toDataURL(r,a);var r,a})};return{getType:a,toBlob:function(){return O.resolve(t)},toDataURL:i,toBase64:function(){return n.split(",")[1]},toAdjustedBlob:function(t,n){return e.then(function(e){return j(e,t,n)})},toAdjustedDataURL:o,toAdjustedBase64:function(e,t){return o(e,t).then(function(e){return e.split(",")[1]})},toCanvas:function(){return e.then(T)}}},U=function(e){return t=e,new O(function(e){var n=new FileReader;n.onloadend=function(){e(n.result)},n.readAsDataURL(t)}).then(function(t){return q(B(e),e,t)});var t},V=function(e,t){return j(e,t).then(function(t){return q(O.resolve(e),t,e.toDataURL())})},$=function(e,t,n){var r=N(e.width,e.height),a=D(r),i=0,o=0;return 90!==(n=0>n?360+n:n)&&270!==n||A(r,r.height,r.width),90!==n&&180!==n||(i=r.width),270!==n&&180!==n||(o=r.height),a.translate(i,o),a.rotate(n*Math.PI/180),a.drawImage(e,0,0),V(r,t)},W=function(e,t,n){var r=N(e.width,e.height),a=D(r);return"v"===n?(a.scale(1,-1),a.drawImage(e,0,-r.height)):(a.scale(-1,1),a.drawImage(e,-r.width,0)),V(r,t)},X=function(e,t){return r=t,(n=e).toCanvas().then(function(e){return W(e,n.getType(),r)});var n,r},K=function(e,t){return r=t,(n=e).toCanvas().then(function(e){return $(e,n.getType(),r)});var n,r},G=Object.keys,Y=function(e,t,n){return void 0===n&&(n=!1),new O(function(r){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&r({status:a.status,blob:a.response})},a.open("GET",e,!0),a.withCredentials=n,function(e,t){for(var n=G(e),r=0,a=n.length;a>r;r++){var i=n[r];t(e[i],i)}}(t,function(e,t){a.setRequestHeader(t,e)}),a.responseType="blob",a.send()})},J=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],Z=[{type:"not_found",message:"Failed to load image."},{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],Q=function(e,t){var n,r,a=(n=function(e,t){return S(e)?e[t]:void 0},r=e,function(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}(t,function(e){r=n(r,e)}),r);return z.from(a)},ee=function(e){var t,n=(t=e,"ImageProxy HTTP error: "+H(J,function(e){return t===e.code}).fold(b("Unknown ImageProxy error"),function(e){return e.message}));return O.reject(n)},te=function(e){return H(Z,function(t){return t.type===e}).fold(b("Unknown service error"),function(e){return e.message})},ne=function(e){return"ImageProxy Service error: "+function(e){try{return z.some(JSON.parse(e))}catch(t){return z.none()}}(e).bind(function(e){return Q(e,["error","type"]).map(te)}).getOr("Invalid JSON in service error message")},re=function(e){return t=e,new O(function(e,n){var r=new FileReader;r.onload=function(){e(r.result)},r.onerror=function(e){n(e)},r.readAsText(t)}).then(function(e){var t=ne(e);return O.reject(t)});var t},ae=function(e){return 200>e||e>=300},ie=function(e,t){var n,r,a,i={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":t};return Y((r=t,a=-1===(n=e).indexOf("?")?"?":"&",/[?&]apiKey=/.test(n)?n:n+a+"apiKey="+encodeURIComponent(r)),i).then(function(e){return ae(e.status)?(t=e.status,n=e.blob,r=t,"application/json"!==(null==(a=n)?void 0:a.type)||400!==r&&403!==r&&404!==r&&500!==r?ee(t):re(n)):O.resolve(e.blob);var t,n,r,a})},oe=function(e,t,n){return void 0===n&&(n=!1),t?ie(e,t):Y(e,{},n).then(function(e){return ae(e.status)?ee(e.status):O.resolve(e.blob)})},ce=U,se=function(e){if(null===e||void 0===e)throw new Error("Node cannot be null or undefined");return{dom:e}},le={fromHtml:function(e,t){var n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||1<n.childNodes.length)throw console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return se(n.childNodes[0])},fromTag:function(e,t){var n=(t||document).createElement(e);return se(n)},fromText:function(e,t){var n=(t||document).createTextNode(e);return se(n)},fromDom:se,fromPoint:function(e,t,n){return z.from(e.dom.elementFromPoint(t,n)).map(se)}},ue=("undefined"!=typeof window||Function("return this;")(),function(e,t){return n=function(e){return function(e,t){var n=e.dom;if(1!==n.nodeType)return!1;var r=n;if(void 0!==r.matches)return r.matches(t);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(t);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(t);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}(e,t)},H(e.dom.childNodes,function(e){return n(le.fromDom(e))}).map(le.fromDom);var n}),fe=tinymce.util.Tools.resolve("tinymce.util.Delay"),de=tinymce.util.Tools.resolve("tinymce.util.Promise"),me=tinymce.util.Tools.resolve("tinymce.util.URI"),ge=function(e){return e.getParam("imagetools_proxy")},he=function(e){var t=function(e){return/^[0-9\.]+px$/.test(e)},n=e.style.width,r=e.style.height;return n||r?t(n)&&t(r)?{w:parseInt(n,10),h:parseInt(r,10)}:null:(n=e.width,r=e.height,n&&r?{w:parseInt(n,10),h:parseInt(r,10)}:null)},pe=function(e){return{w:e.naturalWidth,h:e.naturalHeight}},ye=0,ve=function(e){return ue(le.fromDom(e),"img")},be=function(e,t){return e.dom.is(t,"figure")},we=function(e,t){return e.dom.is(t,"img:not([data-mce-object],[data-mce-placeholder])")},ke=function(e,t){var n=function(t){return we(e,t)&&(ze(e,t)||Se(e,t)||S(ge(e)))};return be(e,t)?ve(t).bind(function(e){return n(e.dom)?z.some(e.dom):z.none()}):n(t)?z.some(t):z.none()},_e=function(e,t){e.notificationManager.open({text:t,type:"error"})},Ce=function(e){var t=e.selection.getNode(),n=e.dom.getParent(t,"figure.image");return null!==n&&be(e,n)?ve(n):we(e,t)?z.some(le.fromDom(t)):z.none()},xe=function(e,t,n){var r=t.match(/(?:\/|^)(([^\/\?]+)\.(?:[a-z0-9.]+))(?:\?|$)/i);return S(r)?e.dom.encode(r[n]):null},ze=function(e,t){var n=t.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new me(n).host===e.documentBaseURI.host},Se=function(e,t){return-1!==y.inArray(e.getParam("imagetools_cors_hosts",[],"string[]"),new me(t.src).host)},Ee=function(e,t){if(Se(e,t))return oe(t.src,null,(n=e,r=t,-1!==y.inArray(n.getParam("imagetools_credentials_hosts",[],"string[]"),new me(r.src).host)));var n,r,a;if(ze(e,t))return F(t);var i=ge(e),o=i+(-1===i.indexOf("?")?"?":"&")+"url="+encodeURIComponent(t.src),c=(a=e).getParam("api_key",a.getParam("imagetools_api_key","","string"),"string");return oe(o,c,!1)},Ne=function(e,t){return n=e,z.from(n.getParam("imagetools_fetch_image",null,"function")).fold(function(){return Ee(e,t)},function(e){return e(t)});var n},Te=function(e,t){var n=e.editorUpload.blobCache.getByUri(t.src);return n?de.resolve(n.blob()):Ne(e,t)},De=function(e){fe.clearTimeout(e.get())},Ae=function(e,t,n,r,a,i,o){return n.toBlob().then(function(c){var s,l,u,f=e.editorUpload.blobCache,d=i.src,m=t.type===c.type;return e.getParam("images_reuse_filename",!1,"boolean")&&(u=f.getByUri(d),l=S(u)?(d=u.uri(),s=u.name(),u.filename()):(s=xe(e,d,2),xe(e,d,1))),u=f.create({id:"imagetools"+ye++,blob:c,base64:n.toBase64(),uri:d,name:s,filename:m?l:void 0}),f.add(u),e.undoManager.transact(function(){var t=function(){var n,o,c;e.$(i).off("load",t),e.nodeChanged(),r?e.editorUpload.uploadImagesAuto():(De(a),n=e,o=a,c=fe.setEditorTimeout(n,function(){n.editorUpload.uploadImagesAuto()},n.getParam("images_upload_timeout",3e4,"number")),o.set(c))};e.$(i).on("load",t),o&&e.$(i).attr({width:o.w,height:o.h}),e.$(i).attr({src:u.blobUri()}).removeAttr("data-mce-src")}),u})},Oe=function(e,t,n,r){return function(){return Ce(e).fold(function(){_e(e,"Could not find selected image")},function(a){return e._scanForImages().then(function(){return Te(e,a.dom)}).then(function(i){return ce(i).then(n).then(function(n){return Ae(e,i,n,!1,t,a.dom,r)})})["catch"](function(t){_e(e,t)})})}},Re=function(e,t,n){return function(){var r=Ce(e).fold(function(){return null},function(e){var t=he(e.dom);return t?{w:t.h,h:t.w}:null});return Oe(e,t,function(e){return K(e,n)},r)()}},Pe=function(e,t,n){return function(){return Oe(e,t,function(e){return X(e,n)})()}},Le=function(e,t,n,r,a){return I(a).then(function(e){var t,i,o,c,s=pe(e);return r.w===s.w&&r.h===s.h||he(n)&&(t=n,(i=s)&&(o=t.style.width,c=t.style.height,(o||c)&&(t.style.width=i.w+"px",t.style.height=i.h+"px",t.removeAttribute("data-mce-style")),o=t.width,c=t.height,(o||c)&&(t.setAttribute("width",String(i.w)),t.setAttribute("height",String(i.h))))),URL.revokeObjectURL(e.src),a}).then(ce).then(function(r){return Ae(e,a,r,!0,t,n)})},je=function(e,t){return function(){var n=Ce(e),r=n.map(function(e){return pe(e.dom)});n.each(function(a){ke(e,a.dom).each(function(){Te(e,a.dom).then(function(a){var i,o={blob:i=a,url:URL.createObjectURL(i)};e.windowManager.open({title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:o}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(a){var i=a.getData().imagetools.blob;n.each(function(n){r.each(function(r){Le(e,t,n.dom,r,i)})}),a.close()},onCancel:v,onAction:function(e,t){switch(t.name){case"save-state":t.value?e.enable("save"):e.disable("save");break;case"disable":e.disable("save"),e.disable("cancel");break;case"enable":e.enable("cancel")}}})})})})}};p.add("imagetools",function(e){var t,n,r,a,i,o,c,s,l=h(0),u=h(null);t=e,n=l,y.each({mceImageRotateLeft:Re(t,n,-90),mceImageRotateRight:Re(t,n,90),mceImageFlipVertical:Pe(t,n,"v"),mceImageFlipHorizontal:Pe(t,n,"h"),mceEditImage:je(t,n)},function(e,n){t.addCommand(n,e)}),a=function(e){return function(){return r.execCommand(e)}},(r=e).ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:a("mceImageRotateLeft")}),r.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:a("mceImageRotateRight")}),r.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:a("mceImageFlipVertical")}),r.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:a("mceImageFlipHorizontal")}),r.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:a("mceEditImage"),onSetup:function(e){var t=function(){var t=Ce(r).forall(function(e){return ke(r,e.dom).isNone()});e.setDisabled(t)};return r.on("NodeChange",t),function(){r.off("NodeChange",t)}}}),r.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image",onAction:a("mceImage")}),r.ui.registry.addContextMenu("imagetools",{update:function(e){return ke(r,e).fold(function(){return[]},function(){return[{text:"Edit image",icon:"edit-image",onAction:a("mceEditImage")}]})}}),(i=e).ui.registry.addContextToolbar("imagetools",{items:i.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions"),predicate:function(e){return ke(i,e).isSome()},position:"node",scope:"node"}),c=l,s=u,(o=e).on("NodeChange",function(e){var t=s.get(),n=ke(o,e.element);t&&!n.exists(function(e){return t.src===e.src})&&(De(c),o.editorUpload.uploadImagesAuto(),s.set(null)),n.each(s.set)})})}();