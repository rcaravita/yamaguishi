= content_for :banner do
	= render partial: "nivo-slider"

#order
	- if @data.active?

		= form_for @order, url: order_update_url, html: {name: 'order_form'} do |f|


			%h1.left Minha Cesta

			- if current_client && !@order.order_items.empty?
				- if @order.total_value < 80 && @order.delivery
					%span{:class => 'right', :style => 'margin-top: 16px; color: #d22f00'} O valor mínimo para pedidos é de R$80,00
				- else
					.right= f.submit "Confirmar Pedido", class: "confirm big", style: "background: #d22f00;", name: "order_confirmed"
			- else
				.right= f.submit "Login para continuar", class: "submit big", style: "background: #d22f00;", name: "order_submit" unless @order.order_items.empty?

			%table
				%thead
					%tr
						%th{:width => 30}
						%th{:width => 30} qtde
						%th produto
						%th{:width => 90} valor
						%th{:width => 80} excluir
				%tbody
					= f.fields_for :order_items do |item|
						%tr
							%td= image_tag item.object.item.image(:mini), class: "image"
							%td= item.text_field :quantity, style: "width: 35px;"
							%td= item.object.name
							%td= number_to_currency(item.object.total_value)
							%td= item.check_box :_destroy
					%tr
						%td.total{colspan: 3} Total dos Produtos
						%td.total= number_to_currency(@order.items_value)
						%td.total= f.submit "Atualizar", class: "update"


			- if current_client && !@order.order_items.empty?
				-# CLIENTE LOGADO E PRODUTOS NA CESTA

				%h2 Detalhes da Entrega

				= f.radio_button :delivery, true, disabled: current_client.route_id == 19 || (@data.only_pickup && @order.new_client)
				Entrega em Domicílio

				= f.radio_button :delivery, false
				Retirada

				- if !@order.delivery
					= f.select :pickup, [['Sítio Yamaguishi', 1], ['Feira do Bosque', 2], ['Feira do Parque Ecológico', 3]]

				- if @data.only_pickup && @order.new_client
					%span{:style => 'margin-top: 10px; margin-bottom: 20px; color: #d22f00; font-weight: bold; display: block; font-size: 12px;'} Devido a situação atual, estamos disponibilizando apenas a opção para retirada no sítio

				%table
					%thead
						%tr
							-#%th cliente
							%th endereço
							%th= @order.delivery == true ? 'data de entrega' : 'data de retirada'
							%th{colspan: 2} taxa de entrega
					%tbody
						%tr
							%td
								- if @order.delivery

									-# ENTREGA
									= current_client.main_address.full_address
									%br
									= "#{current_client.addresses.first.quarter} - #{current_client.addresses.first.city}/#{current_client.addresses.first.state}"
									%br
									= "#{current_client.addresses.first.postcode}"
									%br
									= link_to "[alterar endereço]", client_path

								- else

									- if @order.pickup == 1
										-# RETIRA
										Rod. SP-340 Km 138
										%br
										Jaguariúna - SP - CEP 13820-000
										%br das 7h às 15h
									- if @order.pickup == 2
										-# RETIRA
										Feira do Bosque dos Jequitibás
									- if @order.pickup == 3
										-# RETIRA
										Feira do Parque Ecológico
									- if @order.pickup == 4
										-# RETIRA
										Feira do Centro de Convivência


							%td{:width => 300}
								- if @order.delivery_date
									- if @order.delivery == true
										%b
											= l(@order.delivery_date, format: :delivery)
										%br
										= "(#{@order.client.route.name})"
									- else
										- if @order.pickup == 1
											%p
												%b
													Disponível a partir das 8h de
													= "#{l(get_delivery_date(false, 1), format: :delivery)}."
												%br
												%i
													Atendemos de segunda a sexta-feira das 8h às 17h, e de sábado das 8h às 11h
											= f.date_select :delivery_date
										- else
											%p
												%b
													Disponível a partir das 8h de
													= "#{l(get_delivery_date(false, @order.pickup), format: :delivery)}."
								- else
									A Confirmar
									- if @data.variable_date
										%span{:style => 'color: #d22f00; font-weight: bold; display: block; font-size: 12px;'} Devido a situação atual, a data de entrega/retirada será informada por e-mail, assim como o valor do frete, caso haja

							%td{:width => 90}= @order.delivery_date ? number_to_currency(@order.delivery_value) : "A Confirmar"
							%td{:width => 80}
						%tr
							%td.total{colspan: 2} Total do Pedido
							%td.total= number_to_currency(@order.total_value)
							%td.total
								-#= f.submit "Atualizar", class: "update"

				- if !@order.delivery_date.present?
					%li Após a confirmação do pedido informaremos a data de entrega/retirada e o valor do frete.
				%li Pagamento em dinheiro, cheque ou cartão no ato da entrega/retirada.
				%li= "Número do pedido: #{@order.id.to_s.rjust(6, '0')}"

				.space
				- if @order.total_value < 80 && @order.delivery
					%span{:class => 'right', :style => 'margin-top: 16px; color: #d22f00'} O valor mínimo para pedidos é de R$80,00
				- else
					.right= f.submit "Confirmar Pedido", class: "confirm big", style: "background: #d22f00;", name: "order_confirmed"
				.space

			- else

				.space
				.right= f.submit "Login para continuar", class: "submit big", style: "background: #d22f00;", name: "order_submit" unless @order.order_items.empty?
				.space

			- unless current_client
				.box
					As datas e formas de entrega, incluindo o valor do frete, dependem da identificação do cliente, e serão apresentados na etapa seguinte. Após clicar em "Finalizar Pedido" você ainda terá opção de revisa-lo antes de confirmar. Para mais informações consulte a página
					= link_to "Como Comprar.", "/loja"

			.box
				= Admin::Page.find_by_link("pedido").content.html_safe

			.left= link_to "Comprar Mais", root_path, class: "button"
			.left= link_to "Excluir Pedido", order_destroy_path, class: "button", confirm: "Deseja excluir este pedido?" unless @order.order_items.empty?

	- else
		%h2 Devido a situação atual o site está momentaneamente fechado para novos pedidos
